var e=(e,l,a)=>new Promise((t,i)=>{var r=e=>{try{n(a.next(e))}catch(l){i(l)}},o=e=>{try{n(a.throw(e))}catch(l){i(l)}},n=e=>e.done?t(e.value):Promise.resolve(e.value).then(r,o);n((a=a.apply(e,l)).next())});import{x as l,r as a,j as t,w as i,W as r,y as o,z as n,A as s,K as u,Q as d,u as c,I as p,V as m,M as g,c as v,al as h,H as f,P as y,a6 as b,O as _,aB as V,X as x}from"./vendor-Gjpba6V1.js";import{Q as w}from"./editor-Cn0jQM0z.js";import{a as k}from"./index-C7qi9upo.js";import{E as P,w as C,q as j,G as I,p as U,F as A,H as T,I as E,J as z,K as S,L as B,M as F,C as M,B as D}from"./ui-BjnOHbRg.js";import{_ as L}from"./_plugin-vue_export-helper-BCo6x5W8.js";import{c as G}from"./categories-Z7P03ef2.js";import{a as H}from"./articles-CAehjcUo.js";const W={uploadThumbnail(l){return e(this,null,function*(){const e=new FormData;e.append("thumbnail",l);return(yield k.post("/upload/thumbnail",e,{headers:{"Content-Type":"multipart/form-data"}})).data.data})}},q={class:"rich-text-editor"},R=L(l({__name:"RichTextEditor",props:{modelValue:{},placeholder:{default:"Write your article content..."},readonly:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(l,{emit:u}){const d=l,c=u,p=a();let m=null;const g=()=>{const l=document.createElement("input");l.setAttribute("type","file"),l.setAttribute("accept","image/jpeg,image/jpg,image/png,image/webp"),l.click(),l.addEventListener("change",()=>e(this,null,function*(){var e;const a=null==(e=l.files)?void 0:e[0];if(!a)return;if(!["image/jpeg","image/jpg","image/png","image/webp"].includes(a.type))return void P.error("Please select a valid image file (JPG, PNG, WEBP)");if(a.size>5242880)P.error("Image size must be less than 5MB");else try{const e=P({message:"Uploading image...",type:"info",duration:0}),l=yield W.uploadThumbnail(a);if(e.close(),m){const e=m.getSelection(),a=e?e.index:m.getLength();m.insertEmbed(a,"image",l.url),m.setSelection(a+1,0)}P.success("Image uploaded successfully")}catch(t){P.error("Failed to upload image: "+(t.message||"Unknown error"))}}))},v=[[{header:[1,2,3,!1]}],["bold","italic","underline","strike"],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],[{color:[]},{background:[]}],[{align:[]}],["blockquote","code-block"],["link","image"],["clean"]];return t(()=>{p.value&&(m=new w(p.value,{theme:"snow",placeholder:d.placeholder,readOnly:d.readonly,modules:{toolbar:{container:v,handlers:{image:g}}}}),d.modelValue&&(m.root.innerHTML=d.modelValue),m.on("text-change",()=>{const e=(null==m?void 0:m.root.innerHTML)||"";c("update:modelValue",e)}))}),i(()=>d.modelValue,e=>{m&&e!==m.root.innerHTML&&(m.root.innerHTML=e)}),i(()=>d.readonly,e=>{m&&m.enable(!e)}),r(()=>{m&&(m=null)}),(e,l)=>(n(),o("div",q,[s("div",{ref_key:"editorContainer",ref:p,class:"editor-container"},null,512)]))}}),[["__scopeId","data-v-1ec5abc4"]]),J={class:"image-upload"},N={key:0,class:"upload-placeholder"},O={key:1,class:"preview-container"},K=["src"],Q={class:"preview-overlay"},$={key:0,class:"error-message"},X=L(l({__name:"ImageUpload",props:{modelValue:{},initialUrl:{},maxSize:{default:5}},emits:["update:modelValue"],setup(e,{emit:l}){const t=e,r=l,v=a(),h=a(""),f=a("");i(()=>t.initialUrl,e=>{e&&!t.modelValue&&(h.value=e)},{immediate:!0}),i(()=>t.modelValue,e=>{if(e){const l=new FileReader;l.onload=e=>{var l;h.value=null==(l=e.target)?void 0:l.result},l.readAsDataURL(e)}else t.initialUrl||(h.value="")},{immediate:!0});const y=e=>{var l;const a=null==(l=e.target.files)?void 0:l[0];a&&_(a)},b=e=>{var l;e.preventDefault();const a=null==(l=e.dataTransfer)?void 0:l.files[0];a&&_(a)},_=e=>{f.value="";const l=(e=>{if(!["image/jpeg","image/jpg","image/png","image/webp"].includes(e.type))return"Please select a valid image file (JPG, PNG, WEBP)";const l=1024*t.maxSize*1024;return e.size>l?`File size must be less than ${t.maxSize}MB`:null})(e);l?f.value=l:r("update:modelValue",e)},V=()=>{var e;null==(e=v.value)||e.click()},x=()=>{h.value="",f.value="",r("update:modelValue",null),v.value&&(v.value.value="")};return(e,l)=>(n(),o("div",J,[s("div",{class:"upload-area",onClick:V,onDrop:b,onDragover:l[0]||(l[0]=m(()=>{},["prevent"])),onDragenter:l[1]||(l[1]=m(()=>{},["prevent"]))},[h.value?(n(),o("div",O,[s("img",{src:h.value,alt:"Preview",class:"preview-image"},null,8,K),s("div",Q,[d(c(I),{type:"primary",size:"small",onClick:m(V,["stop"])},{default:p(()=>[d(c(C),null,{default:p(()=>[d(c(U))]),_:1}),l[3]||(l[3]=g(" Change ",-1))]),_:1,__:[3]}),d(c(I),{type:"danger",size:"small",onClick:m(x,["stop"])},{default:p(()=>[d(c(C),null,{default:p(()=>[d(c(A))]),_:1}),l[4]||(l[4]=g(" Remove ",-1))]),_:1,__:[4]})])])):(n(),o("div",N,[d(c(C),{class:"upload-icon"},{default:p(()=>[d(c(j))]),_:1}),l[2]||(l[2]=s("div",{class:"upload-text"},[s("p",null,"Click to upload or drag and drop"),s("p",{class:"upload-hint"},"JPG, PNG, WEBP up to 5MB")],-1))]))],32),s("input",{ref_key:"fileInput",ref:v,type:"file",accept:"image/jpeg,image/jpg,image/png,image/webp",onChange:y,style:{display:"none"}},null,544),f.value?(n(),o("div",$,[d(c(T),{title:f.value,type:"error","show-icon":"",closable:!1},null,8,["title"])])):u("",!0)]))}}),[["__scopeId","data-v-7ad398e1"]]),Y={class:"category-option"},Z={class:"category-name"},ee={key:0,class:"category-description"},le=L(l({__name:"CategorySelect",props:{modelValue:{},disabled:{type:Boolean}},emits:["update:modelValue"],setup(l,{expose:i,emit:r}){const d=r,c=a([]),m=a(!1),g=v(()=>c.value.filter(e=>e&&e.id&&e.name)),V=e=>{d("update:modelValue",e)},x=()=>e(this,null,function*(){try{m.value=!0;const e=yield G.getCategories();c.value=e.categories||[]}catch(e){P.error("Failed to load categories"),c.value=[]}finally{m.value=!1}});return t(()=>{x()}),i({refresh:x}),(e,l)=>{const a=h("el-option"),t=h("el-select");return n(),f(t,{"model-value":e.modelValue,placeholder:"Select a category",loading:m.value,disabled:e.disabled,filterable:"",clearable:"","onUpdate:modelValue":V},{default:p(()=>[(n(!0),o(y,null,b(g.value,e=>(n(),f(a,{key:e.id,label:e.name,value:e.id},{default:p(()=>[s("div",Y,[s("span",Z,_(e.name),1),e.description?(n(),o("span",ee,_(e.description),1)):u("",!0)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["model-value","loading","disabled"])}}}),[["__scopeId","data-v-6a849071"]]),ae={class:"article-editor"},te={class:"action-buttons"},ie=L(l({__name:"ArticleEditor",props:{articleId:{}},setup(l){const i=l,r=V(),u=a(),h=a(!1),f=a(!1),y=a(!1),b=x({title:"",content:"",excerpt:"",category_id:null,status:"draft",thumbnail:null,thumbnail_url:""}),w={title:[{required:!0,message:"Please enter article title",trigger:"blur"},{min:3,max:255,message:"Title must be between 3 and 255 characters",trigger:"blur"}],content:[{required:!0,message:"Please enter article content",trigger:"blur"},{min:10,message:"Content must be at least 10 characters",trigger:"blur"}],category_id:[{required:!0,message:"Please select a category",trigger:"change"}]},k=v(()=>!!i.articleId),C=v(()=>b.title.trim()&&b.content.trim()&&null!==b.category_id);t(()=>e(this,null,function*(){i.articleId&&(yield j())}));const j=()=>e(this,null,function*(){try{y.value=!0;const e=yield H.getArticle(i.articleId);b.title=e.title,b.content=e.content,b.excerpt=e.excerpt||"",b.category_id=e.category.id,b.status=e.status,b.thumbnail_url=e.thumbnail_url||""}catch(e){P.error(e.message||"Failed to load article")}finally{y.value=!1}}),U=e=>{b.thumbnail=e},A=l=>e(this,null,function*(){try{return yield W.uploadThumbnail(l)}catch(e){throw new Error(e.message||"Failed to upload thumbnail")}}),T=()=>e(this,null,function*(){if(!u.value)return!1;try{return yield u.value.validate(),!0}catch(e){return!1}}),L=()=>e(this,null,function*(){if(yield T())try{h.value=!0;let e=b.thumbnail_url;if(b.thumbnail){e=(yield A(b.thumbnail)).url}const l={title:b.title,content:b.content,excerpt:b.excerpt,category_id:b.category_id,status:"draft",thumbnail_url:e};let a;a=k.value?yield H.updateArticle(i.articleId,l):yield H.createArticle(l),P.success("Article saved as draft successfully"),k.value||r.push(`/articles/edit/${a.id}`)}catch(e){P.error(e.message||"Failed to save article")}finally{h.value=!1}}),G=()=>e(this,null,function*(){if(yield T())try{f.value=!0;let e=b.thumbnail_url;if(b.thumbnail){e=(yield A(b.thumbnail)).url}const l={title:b.title,content:b.content,excerpt:b.excerpt,category_id:b.category_id,status:"published",thumbnail_url:e};k.value?yield H.updateArticle(i.articleId,l):yield H.createArticle(l),P.success("Article published successfully"),r.push("/articles")}catch(e){P.error(e.message||"Failed to publish article")}finally{f.value=!1}}),q=()=>{r.push("/articles")},J=()=>{};return(e,l)=>(n(),o("div",ae,[d(c(E),{ref_key:"formRef",ref:u,model:b,rules:w,"label-width":"120px",onSubmit:m(J,["prevent"])},{default:p(()=>[d(c(z),{gutter:20},{default:p(()=>[d(c(S),{span:16},{default:p(()=>[d(c(B),{label:"Title",prop:"title"},{default:p(()=>[d(c(F),{modelValue:b.title,"onUpdate:modelValue":l[0]||(l[0]=e=>b.title=e),placeholder:"Enter article title",size:"large",maxlength:"255","show-word-limit":""},null,8,["modelValue"])]),_:1}),d(c(B),{label:"Content",prop:"content"},{default:p(()=>[d(R,{modelValue:b.content,"onUpdate:modelValue":l[1]||(l[1]=e=>b.content=e),placeholder:"Write your article content here..."},null,8,["modelValue"])]),_:1}),d(c(B),{label:"Excerpt",prop:"excerpt"},{default:p(()=>[d(c(F),{modelValue:b.excerpt,"onUpdate:modelValue":l[2]||(l[2]=e=>b.excerpt=e),type:"textarea",rows:3,placeholder:"Optional excerpt or summary (will be auto-generated if empty)",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1}),d(c(S),{span:8},{default:p(()=>[d(c(B),{label:"Status",prop:"status"},{default:p(()=>[d(c(M),{modelValue:b.status,"onUpdate:modelValue":l[3]||(l[3]=e=>b.status=e),placeholder:"Select status",style:{width:"100%"}},{default:p(()=>[d(c(D),{label:"Draft",value:"draft"}),d(c(D),{label:"Published",value:"published"}),d(c(D),{label:"Archived",value:"archived"})]),_:1},8,["modelValue"])]),_:1}),d(c(B),{label:"Category",prop:"category_id"},{default:p(()=>[d(le,{modelValue:b.category_id,"onUpdate:modelValue":l[4]||(l[4]=e=>b.category_id=e)},null,8,["modelValue"])]),_:1}),d(c(B),{label:"Thumbnail"},{default:p(()=>[d(X,{modelValue:b.thumbnail,"onUpdate:modelValue":[l[5]||(l[5]=e=>b.thumbnail=e),U],"initial-url":b.thumbnail_url},null,8,["modelValue","initial-url"])]),_:1}),d(c(B),null,{default:p(()=>[s("div",te,[d(c(I),{onClick:q},{default:p(()=>l[6]||(l[6]=[g("Cancel",-1)])),_:1,__:[6]}),d(c(I),{type:"primary",onClick:L,loading:h.value,disabled:!C.value},{default:p(()=>l[7]||(l[7]=[g(" Save as Draft ",-1)])),_:1,__:[7]},8,["loading","disabled"]),d(c(I),{type:"success",onClick:G,loading:f.value,disabled:!C.value},{default:p(()=>[g(_(k.value?"Update & Publish":"Publish"),1)]),_:1},8,["loading","disabled"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]))}}),[["__scopeId","data-v-69d213ac"]]);export{ie as A};
