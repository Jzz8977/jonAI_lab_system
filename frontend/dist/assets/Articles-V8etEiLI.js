import{d as ue,r as $,_ as T,c as ce,E as v,o as _e,a as S,s as r,j as x,b as e,w as l,e as o,W as pe,Y as fe,i as H,q as i,m as y,$ as me,a0 as ve,O as ge,P as be,t as c,K as R,J as ye,a1 as Ce,B as he,a2 as we,F,f as ke,h as C}from"./index-CNoniGB4.js";import{a as h}from"./articles-C4RQUdTC.js";import{c as Ae}from"./categories-BQXbkIAO.js";const Se={class:"articles"},De={class:"articles-header"},Ve={class:"header-actions"},$e={class:"filters-section"},ze={key:0,class:"bulk-actions"},Be={class:"bulk-buttons"},Ue={class:"articles-table"},Te={class:"article-title"},xe={class:"article-meta"},Fe={class:"article-stats"},Ee={class:"article-actions"},Pe={class:"pagination-section"},Le={key:0,class:"article-preview"},Me={class:"preview-meta"},Ne={key:0,class:"preview-thumbnail"},je=["src"],Ie={class:"preview-content"},Oe=["innerHTML"],Ke=ue({__name:"Articles",setup(He){const q=ke(),f=$(!1),E=$([]),P=$([]),g=$([]),d=T({search:"",status:void 0,category_id:void 0,page:1,limit:20,orderBy:"created_at",orderDir:"DESC"}),L=T({currentPage:1,totalPages:0,totalCount:0,limit:20,hasNext:!1,hasPrev:!1}),n=T({visible:!1,article:null}),J=ce(()=>{let s;return()=>{clearTimeout(s),s=setTimeout(()=>{_()},500)}}),_=async()=>{try{f.value=!0;const s=await h.getArticles(d);E.value=s.articles,Object.assign(L,s.pagination)}catch(s){v.error(s.message||"Failed to load articles")}finally{f.value=!1}},K=async()=>{try{const s=await Ae.getCategories();P.value=s.categories}catch{v.error("Failed to load categories")}},W=()=>{Object.assign(d,{search:"",status:void 0,category_id:void 0,page:1,limit:20,orderBy:"created_at",orderDir:"DESC"}),_()},Y=s=>{g.value=s},z=()=>{g.value=[]},B=async s=>{try{await F.confirm(`Are you sure you want to set ${g.value.length} article(s) as ${s}?`,"Confirm Bulk Action",{type:"warning"}),f.value=!0;const t=g.value.map(u=>u.id);await h.bulkUpdateStatus(t,s),v.success(`Successfully updated ${t.length} article(s)`),z(),_()}catch(t){t!=="cancel"&&v.error(t.message||"Failed to update articles")}finally{f.value=!1}},G=async()=>{try{await F.confirm(`Are you sure you want to delete ${g.value.length} article(s)? This action cannot be undone.`,"Confirm Bulk Delete",{type:"error"}),f.value=!0;const s=g.value.map(t=>t.id);await h.bulkDelete(s),v.success(`Successfully deleted ${s.length} article(s)`),z(),_()}catch(s){s!=="cancel"&&v.error(s.message||"Failed to delete articles")}finally{f.value=!1}},Q=async(s,t)=>{try{f.value=!0;let u;switch(s){case"published":u=await h.publishArticle(t.id);break;case"archived":u=await h.archiveArticle(t.id);break;default:u=await h.updateArticle(t.id,{status:s})}v.success(`Article ${s} successfully`),_()}catch(u){v.error(u.message||`Failed to ${s} article`)}finally{f.value=!1}},M=s=>{q.push(`/articles/edit/${s.id}`)},N=s=>{n.article=s,n.visible=!0},X=async s=>{try{await F.confirm(`Are you sure you want to delete "${s.title}"? This action cannot be undone.`,"Confirm Delete",{type:"error"}),f.value=!0,await h.deleteArticle(s.id),v.success("Article deleted successfully"),_()}catch(t){t!=="cancel"&&v.error(t.message||"Failed to delete article")}finally{f.value=!1}},j=s=>{switch(s){case"published":return"success";case"draft":return"warning";case"archived":return"info";default:return""}},I=s=>new Date(s).toLocaleDateString();return _e(()=>{_(),K()}),(s,t)=>{var O;const u=o("el-icon"),p=o("el-button"),Z=o("el-input"),w=o("el-col"),m=o("el-option"),D=o("el-select"),ee=o("el-row"),te=o("el-alert"),b=o("el-table-column"),le=o("el-link"),V=o("el-tag"),U=o("el-dropdown-item"),ae=o("el-dropdown-menu"),se=o("el-dropdown"),ie=o("el-table"),oe=o("el-pagination"),k=o("el-descriptions-item"),ne=o("el-descriptions"),re=o("el-dialog"),de=fe("loading");return C(),S("div",Se,[r("div",De,[t[15]||(t[15]=r("h1",null,"Article Management",-1)),r("div",Ve,[e(p,{type:"primary",onClick:t[0]||(t[0]=a=>s.$router.push("/articles/create"))},{default:l(()=>[e(u,null,{default:l(()=>[e(y(me))]),_:1}),t[14]||(t[14]=i(" Create Article ",-1))]),_:1,__:[14]})])]),r("div",$e,[e(ee,{gutter:16},{default:l(()=>[e(w,{span:6},{default:l(()=>[e(Z,{modelValue:d.search,"onUpdate:modelValue":t[1]||(t[1]=a=>d.search=a),placeholder:"Search articles...",clearable:"",onInput:J.value},{prefix:l(()=>[e(u,null,{default:l(()=>[e(y(ve))]),_:1})]),_:1},8,["modelValue","onInput"])]),_:1}),e(w,{span:4},{default:l(()=>[e(D,{modelValue:d.status,"onUpdate:modelValue":t[2]||(t[2]=a=>d.status=a),placeholder:"All Status",clearable:"",onChange:_},{default:l(()=>[e(m,{label:"Draft",value:"draft"}),e(m,{label:"Published",value:"published"}),e(m,{label:"Archived",value:"archived"})]),_:1},8,["modelValue"])]),_:1}),e(w,{span:4},{default:l(()=>[e(D,{modelValue:d.category_id,"onUpdate:modelValue":t[3]||(t[3]=a=>d.category_id=a),placeholder:"All Categories",clearable:"",onChange:_},{default:l(()=>[(C(!0),S(ge,null,be(P.value,a=>(C(),H(m,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(w,{span:4},{default:l(()=>[e(D,{modelValue:d.orderBy,"onUpdate:modelValue":t[4]||(t[4]=a=>d.orderBy=a),onChange:_},{default:l(()=>[e(m,{label:"Created Date",value:"created_at"}),e(m,{label:"Updated Date",value:"updated_at"}),e(m,{label:"Title",value:"title"}),e(m,{label:"Views",value:"view_count"}),e(m,{label:"Likes",value:"like_count"})]),_:1},8,["modelValue"])]),_:1}),e(w,{span:3},{default:l(()=>[e(D,{modelValue:d.orderDir,"onUpdate:modelValue":t[5]||(t[5]=a=>d.orderDir=a),onChange:_},{default:l(()=>[e(m,{label:"Descending",value:"DESC"}),e(m,{label:"Ascending",value:"ASC"})]),_:1},8,["modelValue"])]),_:1}),e(w,{span:3},{default:l(()=>[e(p,{onClick:W},{default:l(()=>t[16]||(t[16]=[i("Reset",-1)])),_:1,__:[16]})]),_:1})]),_:1})]),g.value.length>0?(C(),S("div",ze,[e(te,{title:`${g.value.length} article(s) selected`,type:"info","show-icon":"",closable:!1},{default:l(()=>[r("div",Be,[e(p,{size:"small",onClick:t[6]||(t[6]=a=>B("draft"))},{default:l(()=>t[17]||(t[17]=[i(" Set as Draft ",-1)])),_:1,__:[17]}),e(p,{size:"small",onClick:t[7]||(t[7]=a=>B("published"))},{default:l(()=>t[18]||(t[18]=[i(" Publish ",-1)])),_:1,__:[18]}),e(p,{size:"small",onClick:t[8]||(t[8]=a=>B("archived"))},{default:l(()=>t[19]||(t[19]=[i(" Archive ",-1)])),_:1,__:[19]}),e(p,{size:"small",type:"danger",onClick:G},{default:l(()=>t[20]||(t[20]=[i(" Delete ",-1)])),_:1,__:[20]}),e(p,{size:"small",onClick:z},{default:l(()=>t[21]||(t[21]=[i(" Clear Selection ",-1)])),_:1,__:[21]})])]),_:1},8,["title"])])):x("",!0),r("div",Ue,[pe((C(),H(ie,{data:E.value,onSelectionChange:Y,"empty-text":"No articles found"},{default:l(()=>[e(b,{type:"selection",width:"55"}),e(b,{label:"Title","min-width":"200"},{default:l(({row:a})=>[r("div",Te,[e(le,{onClick:A=>N(a),type:"primary"},{default:l(()=>[i(c(a.title),1)]),_:2},1032,["onClick"]),r("div",xe,[e(V,{size:"small"},{default:l(()=>[i(c(a.slug),1)]),_:2},1024)])])]),_:1}),e(b,{label:"Category",width:"120"},{default:l(({row:a})=>[e(V,{type:"info",size:"small"},{default:l(()=>[i(c(a.category.name),1)]),_:2},1024)]),_:1}),e(b,{label:"Status",width:"100"},{default:l(({row:a})=>[e(V,{type:j(a.status),size:"small"},{default:l(()=>[i(c(a.status),1)]),_:2},1032,["type"])]),_:1}),e(b,{label:"Author",width:"120"},{default:l(({row:a})=>[i(c(a.author.username),1)]),_:1}),e(b,{label:"Stats",width:"100"},{default:l(({row:a})=>[r("div",Fe,[r("span",null,[e(u,null,{default:l(()=>[e(y(R))]),_:1}),i(" "+c(a.view_count),1)]),r("span",null,[e(u,null,{default:l(()=>[e(y(ye))]),_:1}),i(" "+c(a.like_count),1)])])]),_:1}),e(b,{label:"Created",width:"120"},{default:l(({row:a})=>[i(c(I(a.created_at)),1)]),_:1}),e(b,{label:"Actions",width:"200",fixed:"right"},{default:l(({row:a})=>[r("div",Ee,[e(p,{size:"small",onClick:A=>M(a)},{default:l(()=>[e(u,null,{default:l(()=>[e(y(Ce))]),_:1})]),_:2},1032,["onClick"]),e(p,{size:"small",onClick:A=>N(a)},{default:l(()=>[e(u,null,{default:l(()=>[e(y(R))]),_:1})]),_:2},1032,["onClick"]),e(se,{onCommand:A=>Q(A,a)},{dropdown:l(()=>[e(ae,null,{default:l(()=>[e(U,{command:"draft",disabled:a.status==="draft"},{default:l(()=>t[23]||(t[23]=[i(" Set as Draft ",-1)])),_:2,__:[23]},1032,["disabled"]),e(U,{command:"published",disabled:a.status==="published"},{default:l(()=>t[24]||(t[24]=[i(" Publish ",-1)])),_:2,__:[24]},1032,["disabled"]),e(U,{command:"archived",disabled:a.status==="archived"},{default:l(()=>t[25]||(t[25]=[i(" Archive ",-1)])),_:2,__:[25]},1032,["disabled"])]),_:2},1024)]),default:l(()=>[e(p,{size:"small"},{default:l(()=>[t[22]||(t[22]=i(" Status ",-1)),e(u,null,{default:l(()=>[e(y(he))]),_:1})]),_:1,__:[22]})]),_:2},1032,["onCommand"]),e(p,{size:"small",type:"danger",onClick:A=>X(a)},{default:l(()=>[e(u,null,{default:l(()=>[e(y(we))]),_:1})]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"])),[[de,f.value]])]),r("div",Pe,[e(oe,{"current-page":d.page,"onUpdate:currentPage":t[9]||(t[9]=a=>d.page=a),"page-size":d.limit,"onUpdate:pageSize":t[10]||(t[10]=a=>d.limit=a),"page-sizes":[10,20,50,100],total:L.totalCount,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:_,onCurrentChange:_},null,8,["current-page","page-size","total"])]),e(re,{modelValue:n.visible,"onUpdate:modelValue":t[13]||(t[13]=a=>n.visible=a),title:(O=n.article)==null?void 0:O.title,width:"80%",top:"5vh"},{footer:l(()=>[e(p,{onClick:t[11]||(t[11]=a=>n.visible=!1)},{default:l(()=>t[27]||(t[27]=[i("Close",-1)])),_:1,__:[27]}),e(p,{type:"primary",onClick:t[12]||(t[12]=a=>M(n.article))},{default:l(()=>t[28]||(t[28]=[i(" Edit Article ",-1)])),_:1,__:[28]})]),default:l(()=>[n.article?(C(),S("div",Le,[r("div",Me,[e(ne,{column:2,border:""},{default:l(()=>[e(k,{label:"Status"},{default:l(()=>[e(V,{type:j(n.article.status)},{default:l(()=>[i(c(n.article.status),1)]),_:1},8,["type"])]),_:1}),e(k,{label:"Category"},{default:l(()=>[i(c(n.article.category.name),1)]),_:1}),e(k,{label:"Author"},{default:l(()=>[i(c(n.article.author.username),1)]),_:1}),e(k,{label:"Created"},{default:l(()=>[i(c(I(n.article.created_at)),1)]),_:1}),e(k,{label:"Views"},{default:l(()=>[i(c(n.article.view_count),1)]),_:1}),e(k,{label:"Likes"},{default:l(()=>[i(c(n.article.like_count),1)]),_:1})]),_:1})]),n.article.thumbnail_url?(C(),S("div",Ne,[r("img",{src:n.article.thumbnail_url,alt:"Article thumbnail"},null,8,je)])):x("",!0),r("div",Ie,[t[26]||(t[26]=r("h3",null,"Content:",-1)),r("div",{innerHTML:n.article.content},null,8,Oe)])])):x("",!0)]),_:1},8,["modelValue","title"])])}}});export{Ke as default};
